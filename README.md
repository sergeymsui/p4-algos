# p4-algos

## Load-balancer

Пояснения к скрипту:
Балансировка нагрузки осуществляется путем вычисления хэш-функции (crc32) от MAC-адресов источника и назначения. Полученное значение используется для выбора одного из заданного числа портов (NUM_BACKENDS) для равномерного распределения нагрузки. Это базовый сценарий, который может быть легко расширен до использования IP-адресов или TCP/UDP-портов для более сложных схем балансировки.

## QoS Priority

Принцип работы предложенного алгоритма QoS:
Пакеты классифицируются на основе поля Differentiated Services (DiffServ) в IPv4-заголовке.
В таблице qos_classifier реализуется точное соответствие (exact match) поля DiffServ с заданными приоритетами.
Метаданные приоритета (meta.priority) передаются в стандартные метаданные, влияя на выбор очереди на выходном интерфейсе.
Приоритеты:
Высокий (priority = 7)
Средний (priority = 4)
Низкий (priority = 1)

Пример таблицы для настройки классификации:

table_add qos_classifier set_high_priority 0x2e => # Expedited Forwarding (EF)
table_add qos_classifier set_medium_priority 0x1a => # Assured Forwarding (AF21)
table_add qos_classifier set_low_priority 0x00 => # Best Effort (BE)

## policy_routing

Логика работы:
Пакеты маршрутизируются по политике, основанной на IP-адресе источника и назначения.
Позволяет явно задавать интерфейс, через который отправляется трафик в зависимости от политики.

Пример добавления политик маршрутизации:

Формат: source_ip/prefix dst_ip/prefix => port

table_add policy_routing route 10.0.1.0/24 10.0.2.0/24 => 2
table_add policy_routing route 10.0.2.0/24 10.0.3.0/24 => 3
table_add policy_routing route 0.0.0.0/0 10.0.4.0/24 => 4

Трафик от сети 10.0.1.0/24 до 10.0.2.0/24 отправляется через порт 2.
Другие правила работают аналогично, обеспечивая гибкость в маршрутизации на основе политики.

## congestion_control

Описание алгоритма управления перегрузками:

Используется ECN (Explicit Congestion Notification) в IPv4 заголовке.
Если коммутатор обнаруживает перегрузку (количество пакетов превышает порог), он устанавливает поле ECN в значение CE (Congestion Experienced).
Конечные хосты, получая такие пакеты, снижают скорость отправки данных, что снижает нагрузку на сеть.

Примечания:
В реальных сценариях для оценки перегрузок применяются более сложные алгоритмы, использующие размеры очередей, задержки пакетов и другие параметры сети.
Приведённая реализация — упрощённая версия, демонстрирующая базовый подход.

Возможности улучшения:

Добавление динамического управления порогами на основе состояния очередей.
Реализация механизма INT (In-band Network Telemetry) для более точного мониторинга перегрузок в реальном времени.
Данный пример наглядно показывает, как можно реализовать простейшие механизмы динамического контроля перегрузок с использованием языка программирования P4.
